import express from 'express';
import path from 'path';

import usuariosRoute from './routes/usuariosRoute.js'; // Correct
import guitaristRoute from './routes/guitaristsRoute.js'; // Correct
import albumsRoute from './routes/albumsRoute.js'; // Correct
import comentariosRoute from './routes/comentariosGuitRoute.js'; // Correct

import mongoose from 'mongoose';
import dotenv from "dotenv";
import cors from 'cors';


import validateBody from './validation.js';
import { fileURLToPath } from 'url';
import { Server as socketIo } from 'socket.io';


dotenv.config(); // Load environment variables

const app = express();
const port = 3000;

import http from 'http';
const server = http.createServer(app);
//const io = new socketIo(server);
const io = new socketIo(server, {
  cors: {
    origin: ['http://localhost:5173'],
    methods: ['GET', 'POST', 'PUT', 'DELETE'],
    credentials: true,
  }
})

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Connect to MongoDB
mongoose.connect(process.env.MONGODB_URI, { useNewUrlParser: true, useUnifiedTopology: true })
  .then(() => console.log("Successfully connected to MongoDB"))
  .catch((err) => console.error("MongoDB connection error:", err));

//Middleware to parse JSON request bodies
app.use(cors());
app.use(express.json());
app.use(express.urlencoded({extended:true}));
app.use(validateBody);

//console.log(guitaristRoutes);
// app.get("/", (req, res) => {
//     res.sendFile(path.join(__dirname, 'public', "index.html"));
// });
app.get('/', (req, res) => {
  res.send("Database de la Base de Datos de Guitarristas");
});
app.use('/usuarios', usuariosRoute);
app.use('/guitarists', guitaristRoute);
app.use('/albums', albumsRoute);
app.use('/comentarios', comentariosRoute);

export { io };
//socket
io.on('connection', (socket) => {
  console.log('Un cliente se ha conectado', socket.id);


  socket.on('mensaje', (data) => {
    console.log('´mensaje recibido', data);
    io.emit('mensaje', `Servidor: ${data}`);
  });


  socket.on('disconnect', () => {
    console.log('Un cliente se ha desconectado');
  });
})
server.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
    console.log(`    ░▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▒
        ░▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓▀▌▀▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓▓  ░   ▀▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓███████▓▓▓▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓██████████▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▀▓█▓▀▀▓▌▐▀▒▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▄███▄▓▌  ▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌█████▀  ▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌█████▀░▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▀▀▀▀▀░  ▀▀▀   ░▀▀▀▀▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▀        ░               ▀▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌ ░                         ▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▒▒░░                  ▒░      ▐▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▒░▒▒░            ░    ░░▓██▄     ▀▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▀░▄▓▓██░ ░         ░░ ░▄▐▄▒▌▀█▓░     ▀▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▄▒▒▒█▓▓░           ░  ░▒▒▓███▓▓█▓▄    ▀▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌███▀▀▌▀              ░░░▒▓███▌▌▓███▄  ▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▓█▌▒▌ ░▌      ░    ░░ ░ ░▒▒▓▓▌▌▌▌▌▓██▄▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▓▒█▌▌░ ░ ░░░░   ░   ▐ ░░▒░▓▒▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▓░░▌▌▌░ ░░░░ ░░░ ░ ░ ░░  ░▒▄▌▌▀▀▀▀▀▀▀▀▌▌▌▌▒▌▀▒▒▌▌▌▐▀▒▐▒▌▒░ ▒▌▌▌▌░ ▒▌▌▌▌▌▌
        ░▓▌▌▌▌▓░▓▓▌▌▌▓▄▄▄▄▒░░░░░░░   ░ ░▌▌▌▌▒        ▐▌▌▒▒  ▒▌▌▓▐  ░▐▌    ▐▌▌▌   ▓▌▌▌▌▌
        ░▓▌▌▌▌▓▓▓█▀▓▌▀▓██████▓▓▄▌▄▄▄▄▓▒▌▌▌▌▌▒   ▌▄▄   ▐▌▒▒  ▒▌▌▌▒  ░▐▌    ░▀▌▓   ▐▌▌▌▌▌
        ░▓▌▌▌▌▌█▓▌▌▌▌▒▒▒░░▐▀▀▓██████▀▀░ ▐▌▌▌▒   ▌▌▌    ▌▌░  ▐▌▌▓▒   ▐▌░    ▒▓▓   ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▒▌███▓▄▄▄▒▐▄▄▒░░░    ▐▌▌▌   ▌▌▓   ▐▌▌   ▐▌▌▌▒   ▓▌      ▐▌░  ▀▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▀▒▀▒░░░▒▀▄░▄▓░ ░▀░░░▐▌▌▌         ▓▌▌   ▐▌▌▌░   ▓▌   ▐   ▀▒  ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▄░░░      ░▓█▄░░░░░▐▌▌▌▌   ▄    ▌▌▌▌   ▐▌▌▌▒   ▐▌   ▐▌      ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▒░░░       ▓█▀▐░░░▌▌▌▌▌  ░▌▌   ▀▌▌▒   ▐▌▌▓░   ▐▌   ▐▌▒     ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▒░░░░     ▐█░░░ ▓▌▌▌▌▒  ░▌▓░  ▐▌▌▌   ▐▌▌▓░  ░▓▌░  ▐▌▌▒    ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▓▒▒░░░     ▓█░░▐▌▌▌▌▌▒   ▌▌▌   ▐▌▌░  ░     ░▐▌▌   ▐▌▌▌▒   ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓▌░░░    ▐█▓░▓▌▌▌▌▌▒   ▌▌▓   ▒▓▌▓▄▌░ ░▒▒▒▓▌▌▌░░▒▐▌▌▌▌▌▒▒▓▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓▓▒░░░   ▀▒▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▀▒▀▀▀▀▀░   ▒▌▌▌▌▌▌▌▀▀▀▀▓▌▀▀▀▀▌▌▌▌▌▌▌▌▌▌▌▌▌▀▀▀▓▌▌▀▀▀▌▌▌▌▌▓▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▓██▓▌▀▓█▓▄     ▌▌▌▌▌▌▌ ▐▄▄▌  ▄  ▀    ▐▌    ▐▒ ▄▄▄▌ ▄▄ ▐▄▄  ▄▄▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▓█████▄█▀▓█▓░░▓▐▌▌▌▌▌▌▌ ▐▀▓▌ ▐▌▒ ▐ ▐▌  ▌ ▐▌  ▒ ▀▌▌▌ ░▓▌▌▌▌ ▐▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▒█████▒██▀▀▀▒▓▌▌▌▌▌▌▌▒ ▐▄▐▌ ▐▌▒ ▐    ▐▌    ▓▒ ▄▄▓▌▌░ ░▓▌▌ ▐▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌░▀██▀▒▓▒▓▒▐░▓░▓▌▌▌▌▌▌▒ ▓▌▌▌ ▐▌░ ▐ ▐▌ ▐▌ ▐░ ▓▒ ▓▌▌▀▒▌▓  ▌▌ ▐▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌░ ░ ▐▒░░▒▄▄█▒▌▓▌▌▌▌▌▌▒ ▐▌▌▓▒░  ▒▓ ▐▌  ▌ ▐▌ ▐▒   ░▌░░ ░▄▌▌░▐▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌░░░ ▐▌░░▄▌▀█▓▐▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌░  ▐▓▐███▓▓█▌▒▌▌▌▌▌▌▌▓▀▓▓▓▀▓▌▌▌▌▌▒▌▀▐▌▌▌▌▐▀▀▌▒▌▌▒▀▀▌▌▌▌▀▀▀▓▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓▓▌▒▀▌▀█▓▒▓▒▐▌▌▌▌▌▌▒        ▐▌▌▒▒  ▒▌▌▓▒  ░▐▌    ▐▌▌▌   ▓▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓▌▀▀▀▓▌▄▐▌▌▌▌▌▌▒   ▄▄▄   ▐▌▒▒  ▒▌▌▓▒  ░▐▌    ▐▓▌▓░  ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▒▓▄░░░░▒▒▌▌▌▌▌▌▌   ▌▌▌    ▌▌░  ▐▌▌▓▒  ▐▐▌     ▒▓▓   ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▀▓▒░░░░░▐▌▌▌▌▌▌   ▌▌▌   ▐▌▌   ▐▌▌▌▒   ▓▌░     ▐▓░  ▓▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓▄▒░░░░▄▄▌▌▌▌▌▌   ░░    ▓▌▌   ▐▌▌▌▒   ▓▌   ▌   ▀▒  ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓██▀▓█▓▌▌▌▌▌▌▌        ▓▌▌▌   ▐▌▌▌▒   ▐▌   ▓▌      ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▀    ▀▌▌▌▌▌▌▌  ░▌▌   ▓▌▌▒   ▐▌▌▓░   ▐▌   ▐▌▒     ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌      ▀▌▌▌▌▌▒  ░▌▓░  ▐▌▌▌   ▐▌▌▌░   ▓▌░  ▓▌▌░    ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌       ░▓▌▌▌▒   ▌▌▌   ▀▌▌░   ░     ▒▌▌   ▐▌▌▌▒   ▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▄▄▀████▓▌▌▌▌▒   ▌▌▓   ▒▓▌▓▄▒░ ░▄▒▒▄▓▌▌░ ░▐▌▌▌▌▄░▒▐▌▌▌▌▌
        ░▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓▓▌▌▌▌▌▌▌▌▌▓▌▓▌▌▌▌▓▓▓▓▌▌▌▌▌▌▓▓▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
        ░▀▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▓▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌▌
                                                                                    ░`);
    console.log(`
    
      ██████╗ ██╗   ██╗███╗   ██╗     █████╗ ██████╗ ██╗    ██████╗ ██╗   ██╗███╗   ██╗██╗
      ██╔══██╗██║   ██║████╗  ██║    ██╔══██╗██╔══██╗██║    ██╔══██╗██║   ██║████╗  ██║██║
      ██████╔╝██║   ██║██╔██╗ ██║    ███████║██████╔╝██║    ██████╔╝██║   ██║██╔██╗ ██║██║
      ██╔══██╗██║   ██║██║╚██╗██║    ██╔══██║██╔═══╝ ██║    ██╔══██╗██║   ██║██║╚██╗██║╚═╝
      ██║  ██║╚██████╔╝██║ ╚████║    ██║  ██║██║     ██║    ██║  ██║╚██████╔╝██║ ╚████║██╗
      ╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═══╝    ╚═╝  ╚═╝╚═╝     ╚═╝    ╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═══╝╚═╝
                                                                  
            `);
});




